<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Vídeos - EducaWeb</title>

    <style>
        * { box-sizing: border-box; }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #0f172a;
            margin: 0;
            min-height: 100vh;
            color: #e2e8f0;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 16px 24px;
            background: #020617;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 4px rgba(0,0,0,0.5);
        }

        header h1 {
            margin: 0;
            font-size: 20px;
        }

        header button {
            padding: 8px 14px;
            border-radius: 8px;
            border: none;
            background: #ef4444;
            color: white;
            font-size: 13px;
            cursor: pointer;
        }

        .container {
            padding: 24px;
            max-width: 960px;
            width: 100%;
            margin: 0 auto;
        }

        h2 {
            margin-top: 0;
            margin-bottom: 8px;
        }

        p.subtitle {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 13px;
            color: #94a3b8;
        }

        .status {
            font-size: 14px;
            margin-bottom: 16px;
        }

        .status.error { color: #f97373; }
        .status.info { color: #38bdf8; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
        }

        .card {
            background: #020617;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            border: 1px solid #1e293b;
        }

        .card a {
            color: #38bdf8;
            font-weight: 600;
            text-decoration: none;
            word-break: break-all;
        }

        .card a:hover {
            text-decoration: underline;
        }

        .descricao {
            margin-top: 8px;
            font-size: 14px;
            color: #cbd5f5;
        }
    </style>
</head>
<body>

<header>
    <h1>EducaWeb - Vídeos</h1>
    <button onclick="logout()">Sair</button>
</header>

<div class="container">
    <h2>Olá!</h2>
    <p class="subtitle">
        Bem vindo ao EducaWeb, aqui trazemos vídeos para ajudar na sua trajetoria profissional!
    </p>

    <div id="status" class="status info">Carregando vídeos...</div>

    <div id="lista" class="grid"></div>
</div>

<script>
    function logout() {
        sessionStorage.removeItem("email");
        sessionStorage.removeItem("password");
        window.location.href = "/login.html";
    }

    async function carregarVideos() {
        const email = sessionStorage.getItem("email");
        const password = sessionStorage.getItem("password");

        const statusEl = document.getElementById("status");
        const listaEl = document.getElementById("lista");

        // Se não tem credenciais salvas, redireciona para login
        if (!email || !password) {
            window.location.href = "/login.html";
            return;
        }

        statusEl.textContent = "Carregando vídeos...";

        try {
            const authHeader = "Basic " + btoa(email + ":" + password);

            const resposta = await fetch("/api/videos?page=0&size=20", {
                method: "GET",
                headers: {
                    "Authorization": authHeader
                }
            });

            if (resposta.status === 401) {
                statusEl.className = "status error";
                statusEl.textContent = "Sessão expirada ou não autorizada. Redirecionando para login...";
                setTimeout(() => logout(), 1500);
                return;
            }

            if (!resposta.ok) {
                statusEl.className = "status error";
                statusEl.textContent = "Erro ao carregar vídeos. Código: " + resposta.status;
                return;
            }

            const data = await resposta.json(); // Page<VideoDTO>
            const videos = data.content || [];

            if (videos.length === 0) {
                statusEl.className = "status info";
                statusEl.textContent = "Nenhum vídeo cadastrado.";
                return;
            }

            statusEl.textContent = "";
            listaEl.innerHTML = "";

            videos.forEach(v => {
                const card = document.createElement("div");
                card.className = "card";

                const link = document.createElement("a");
                link.href = v.link;
                link.target = "_blank";
                link.rel = "noopener noreferrer";
                link.textContent = v.link;

                const desc = document.createElement("p");
                desc.className = "descricao";
                desc.textContent = v.descricao;

                card.appendChild(link);
                card.appendChild(desc);

                listaEl.appendChild(card);
            });

        } catch (e) {
            console.error(e);
            statusEl.className = "status error";
            statusEl.textContent = "Erro de conexão com o servidor.";
        }
    }

    // Ao carregar a página, busca os vídeos
    window.addEventListener("DOMContentLoaded", carregarVideos);
</script>

</body>
</html>
